{% extends 'base.html' %}

{% block title %}Analytics - PaddySense{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1 class="text-success">ðŸ“Š Data Analytics</h1>
            <a href="{% url 'main:home' %}" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
        </div>
    </div>
</div>

<!-- Key Performance Indicators -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-line"></i> Key Performance Indicators
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    {% for kpi in kpis %}
                    <div class="col-md-6 col-lg-3 mb-3">
                        <div class="card border-0 shadow-sm">
                            <div class="card-body text-center">
                                <div class="mb-3">
                                    <i class="{{ kpi.icon }} fa-3x text-{{ kpi.color }}"></i>
                                </div>
                                <h4 class="text-{{ kpi.color }} mb-1">{{ kpi.value }}</h4>
                                <h6 class="text-muted mb-1">{{ kpi.title }}</h6>
                                <div class="d-flex align-items-center justify-content-center">
                                    {% if kpi.trend == 'up' %}
                                        <i class="fas fa-arrow-up text-success me-1"></i>
                                        <span class="text-success">{{ kpi.change }}</span>
                                    {% else %}
                                        <i class="fas fa-arrow-down text-danger me-1"></i>
                                        <span class="text-danger">{{ kpi.change }}</span>
                                    {% endif %}
                                </div>
                                <small class="text-muted">{{ kpi.description }}</small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Section -->
<div class="row mb-4">
    <!-- Yield Trends Chart -->
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-area"></i> Yield Trends (Monthly)
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Month</th>
                                <th>Actual Yield (kg)</th>
                                <th>Target (kg)</th>
                                <th>Performance</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for trend in yield_trends %}
                            <tr>
                                <td><strong>{{ trend.month }}</strong></td>
                                <td>{{ trend.yield }}</td>
                                <td>{{ trend.target }}</td>
                                <td>
                                    {% if trend.yield > 0 %}
                                        {% if trend.yield >= trend.target %}
                                            <span class="badge badge-success">âœ“ On Target</span>
                                        {% else %}
                                            <span class="badge badge-warning">âš  Below Target</span>
                                        {% endif %}
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Weather Impact Chart -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-cloud-sun"></i> Weather Impact Score
                </h5>
            </div>
            <div class="card-body">
                {% for factor in weather_impact %}
                <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-1">
                        <span class="font-weight-bold">{{ factor.factor }}</span>
                        <span class="badge badge-{% if factor.impact == 'Positive' %}success{% elif factor.impact == 'Negative' %}danger{% else %}secondary{% endif %}">
                            {{ factor.impact }}
                        </span>
                    </div>
                    <div class="progress mb-1" style="height: 8px;">
                        <div class="progress-bar bg-{% if factor.impact == 'Positive' %}success{% elif factor.impact == 'Negative' %}danger{% else %}secondary{% endif %}" 
                             style="width: {{ factor.score|floatformat:0 }}%"></div>
                    </div>
                    <small class="text-muted">{{ factor.description }}</small>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Soil Moisture and Performance Data -->
<div class="row mb-4">
    <!-- Soil Moisture Trends -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-warning text-dark">
                <h5 class="card-title mb-0">
                    <i class="fas fa-thermometer-half"></i> Soil Conditions (Last 7 Days)
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Moisture (%)</th>
                                <th>Temp (Â°C)</th>
                                <th>pH</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for soil in soil_moisture_data %}
                            <tr>
                                <td>{{ soil.date|date:"M d" }}</td>
                                <td>
                                    <span class="badge badge-{% if soil.moisture >= 70 %}success{% elif soil.moisture >= 60 %}warning{% else %}danger{% endif %}">
                                        {{ soil.moisture }}%
                                    </span>
                                </td>
                                <td>{{ soil.temperature }}Â°C</td>
                                <td>{{ soil.ph }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Performance Summary -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-trophy"></i> Performance Summary
                </h5>
            </div>
            <div class="card-body">
                <div class="row text-center">
                    <div class="col-6 mb-3">
                        <h4 class="text-success">2,847 kg</h4>
                        <small class="text-muted">Total Yield</small>
                    </div>
                    <div class="col-6 mb-3">
                        <h4 class="text-info">85%</h4>
                        <small class="text-muted">Efficiency</small>
                    </div>
                    <div class="col-6 mb-3">
                        <h4 class="text-warning">â‚¹52,665</h4>
                        <small class="text-muted">Revenue</small>
                    </div>
                    <div class="col-6 mb-3">
                        <h4 class="text-danger">â‚¹-4</h4>
                        <small class="text-muted">Net Profit</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Historical Performance Table -->
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-history"></i> Historical Performance Data
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead class="thead-dark">
                            <tr>
                                <th>Season</th>
                                <th>Crop</th>
                                <th>Area</th>
                                <th>Yield</th>
                                <th>Revenue</th>
                                <th>Cost</th>
                                <th>Profit</th>
                                <th>Efficiency</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for performance in performance_data %}
                            <tr>
                                <td><strong>{{ performance.season }}</strong></td>
                                <td>{{ performance.crop }}</td>
                                <td>{{ performance.area }}</td>
                                <td>{{ performance.yield }}</td>
                                <td>{{ performance.revenue }}</td>
                                <td>{{ performance.cost }}</td>
                                <td>
                                    <span class="badge badge-{% if performance.profit == 'â‚¹-4' or performance.profit == 'â‚¹-1,377' or performance.profit == 'â‚¹-3,150' %}danger{% else %}success{% endif %}">
                                        {{ performance.profit }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge badge-{% if performance.efficiency == '85%' %}success{% elif performance.efficiency == '78%' %}warning{% else %}danger{% endif %}">
                                        {{ performance.efficiency }}
                                    </span>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="row mt-4">
    <div class="col-md-12 text-center">
        <a href="{% url 'main:dashboard' %}" class="btn btn-success btn-lg me-3">
            <i class="fas fa-chart-line"></i> View Dashboard
        </a>
        <a href="{% url 'main:weather' %}" class="btn btn-outline-success btn-lg me-3">
            <i class="fas fa-cloud-sun"></i> Weather Insights
        </a>
        <a href="{% url 'main:contact' %}" class="btn btn-outline-secondary btn-lg">
            <i class="fas fa-phone"></i> Contact Support
        </a>
    </div>
</div>
{% endblock %}
