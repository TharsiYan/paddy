{% extends 'base.html' %}
{% load translate_tags %}

{% block title %}{% custom_trans_simple "Soil Temperature & Location Input" %}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="fas fa-edit"></i> {% custom_trans_simple "Enter Your Data" %}</h5>
                    <div>
                        <a href="{% url 'main:paddy_history' %}" class="btn btn-outline-info btn-sm">
                            <i class="fas fa-history"></i> {% custom_trans_simple "View History" %}
                        </a>
                    </div>
                </div>
                <div class="card-body">
                    <form method="POST">
                        {% csrf_token %}
                        
                        <!-- Location Input -->
                        <div class="mb-3">
                            <label for="location" class="form-label">
                                <i class="fas fa-map-marker-alt text-danger"></i> {% custom_trans_simple "Location" %}
                            </label>
                            <input type="text" class="form-control" id="location" name="location" 
                                   placeholder="{% custom_trans_simple 'e.g., Jaffna, Sri Lanka' %}" 
                                   value="{{ location|default:'' }}" required>
                            <small class="text-muted">{% custom_trans_simple "Enter your farm location" %}</small>
                        </div>

                        <!-- Field Name Input -->
                        <div class="mb-3">
                            <label for="field_name" class="form-label">
                                <i class="fas fa-seedling text-success"></i> {% custom_trans_simple "Field Name" %}
                            </label>
                            <input type="text" class="form-control" id="field_name" name="field_name" 
                                   placeholder="{% custom_trans_simple 'e.g., Field A1, Rice Field' %}" 
                                   value="{{ field_name|default:'' }}" required>
                            <small class="text-muted">{% custom_trans_simple "Give your field a name" %}</small>
                        </div>

                        <!-- Soil Temperature Input -->
                        <div class="mb-3">
                            <label for="soil_temperature" class="form-label">
                                <i class="fas fa-thermometer-half text-danger"></i> {% custom_trans_simple "Soil Temperature (¬∞C)" %}
                            </label>
                            <input type="number" step="0.1" class="form-control" id="soil_temperature" name="soil_temperature" 
                                   placeholder="{% custom_trans_simple 'e.g., 25.5' %}" 
                                   value="{{ soil_temperature|default:'' }}" required>
                            <small class="text-muted">{% custom_trans_simple "Measure soil temperature at 10cm depth" %}</small>
                        </div>

                        <!-- Soil Type Input -->
                        <div class="mb-3">
                            <label for="soil_type" class="form-label">
                                <i class="fas fa-layer-group text-warning"></i> {% custom_trans_simple "Soil Type" %}
                            </label>
                            <select class="form-select" id="soil_type" name="soil_type" required>
                                <option value="loamy" {% if soil_type == 'loamy' %}selected{% endif %}>{% custom_trans_simple "Loamy (Best for paddy)" %}</option>
                                <option value="clay" {% if soil_type == 'clay' %}selected{% endif %}>{% custom_trans_simple "Clay (Good water retention)" %}</option>
                                <option value="sandy" {% if soil_type == 'sandy' %}selected{% endif %}>{% custom_trans_simple "Sandy (Needs more care)" %}</option>
                                <option value="silt" {% if soil_type == 'silt' %}selected{% endif %}>{% custom_trans_simple "Silt (Moderate)" %}</option>
                            </select>
                            <small class="text-muted">{% custom_trans_simple "Select your soil type for better recommendations" %}</small>
                        </div>

                        <!-- Season Input -->
                        <div class="mb-3">
                            <label for="season" class="form-label">
                                <i class="fas fa-calendar-alt text-info"></i> {% custom_trans_simple "Planting Season" %}
                            </label>
                            <select class="form-select" id="season" name="season" required>
                                <option value="current" {% if season == 'current' %}selected{% endif %}>{% custom_trans_simple "Current Season" %}</option>
                                <option value="yala" {% if season == 'yala' %}selected{% endif %}>{% custom_trans_simple "Yala (Feb-May)" %}</option>
                                <option value="maha" {% if season == 'maha' %}selected{% endif %}>{% custom_trans_simple "Maha (Sep-Mar)" %}</option>
                                <option value="summer" {% if season == 'summer' %}selected{% endif %}>{% custom_trans_simple "Summer" %}</option>
                                <option value="winter" {% if season == 'winter' %}selected{% endif %}>{% custom_trans_simple "Winter" %}</option>
                            </select>
                            <small class="text-muted">{% custom_trans_simple "Select your planting season" %}</small>
                        </div>
                        
                        <button type="submit" class="btn btn-success btn-lg w-100">
                            <i class="fas fa-save"></i> {% custom_trans_simple "Get Paddy Recommendations" %}
                        </button>
                    </form>
                </div>
            </div>

            <!-- Paddy Recommendations Section -->
            {% if success and recommendations %}
            <div class="card mt-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-seedling"></i> {% custom_trans_simple "Intelligent Paddy Recommendations" %}
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Summary -->
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> 
                        <strong>{{ recommendations.explanation }}</strong>
                    </div>
                    
                    <!-- Quick Summary - Best Paddy Types for Current Time -->
                    <div class="card border-success mb-3">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-seedling"></i> {% custom_trans_simple "üåæ Best Paddy Types for Current Time" %}
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6 class="text-success">{% custom_trans_simple "üèÜ Top Choice:" %}</h6>
                                    <p class="mb-1"><strong>{{ recommendations.primary_varieties.0 }}</strong></p>
                                    <small class="text-muted">{% custom_trans_simple "Best overall for your current conditions" %}</small>
                                </div>
                                <div class="col-md-6">
                                    <h6 class="text-info">{% custom_trans_simple "üìÖ Season Best:" %}</h6>
                                    {% if recommendations.seasonal_varieties %}
                                        <p class="mb-1"><strong>{{ recommendations.seasonal_varieties.0 }}</strong></p>
                                        <small class="text-muted">{% custom_trans_simple "Perfect for current season" %}</small>
                                    {% else %}
                                        <p class="mb-1"><strong>{{ recommendations.primary_varieties.1 }}</strong></p>
                                        <small class="text-muted">{% custom_trans_simple "Excellent alternative choice" %}</small>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Current Time Recommendations -->
                    {% if recommendations.current_time_recommendations %}
                        <div class="alert alert-primary">
                            <h6 class="text-primary">
                                <i class="fas fa-clock"></i> {% custom_trans_simple "Current Time Recommendations" %}
                            </h6>
                            <p class="mb-0">{{ recommendations.current_time_recommendations }}</p>
                        </div>
                    {% endif %}
                    
                    <!-- Immediate Actions -->
                    {% if recommendations.immediate_actions %}
                        <div class="alert alert-warning">
                            <h6 class="text-warning">
                                <i class="fas fa-exclamation-triangle"></i> {% custom_trans_simple "Immediate Actions Required" %}
                            </h6>
                            <ul class="mb-0">
                                {% for action in recommendations.immediate_actions %}
                                    <li>{{ action }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    
                    <!-- Primary Varieties -->
                    <div class="mb-4">
                        <h6 class="text-success">
                            <i class="fas fa-star"></i> {% custom_trans_simple "Recommended Paddy Varieties" %}
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary">{% custom_trans_simple "Primary Choices:" %}</h6>
                                <ul class="list-group list-group-flush">
                                    {% for variety in recommendations.primary_varieties %}
                                        <li class="list-group-item">
                                            <i class="fas fa-check text-success"></i> {{ variety }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-secondary">{% custom_trans_simple "Alternative Choices:" %}</h6>
                                <ul class="list-group list-group-flush">
                                    {% for variety in recommendations.secondary_varieties %}
                                        <li class="list-group-item">
                                            <i class="fas fa-arrow-right text-info"></i> {{ variety }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Seasonal Varieties -->
                    {% if recommendations.seasonal_varieties %}
                        <div class="mb-4">
                            <h6 class="text-info">
                                <i class="fas fa-calendar-alt"></i> {% custom_trans_simple "Best for Current Season" %}
                            </h6>
                            <div class="row">
                                {% for variety in recommendations.seasonal_varieties %}
                                    <div class="col-md-6 mb-2">
                                        <div class="card border-info">
                                            <div class="card-body p-2">
                                                <h6 class="text-info mb-1">{{ variety }}</h6>
                                                <small class="text-muted">{% custom_trans_simple "Perfect for current conditions" %}</small>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                    
                    <!-- Growing Tips -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-clock"></i> {% custom_trans_simple "Planting Timing" %}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">{{ recommendations.planting_timing }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-info">
                                <div class="card-header bg-info text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-tint"></i> {% custom_trans_simple "Water Management" %}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">{{ recommendations.water_management }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Soil and Fertilizer Tips -->
                    <div class="row mt-3">
                        <div class="col-md-6">
                            <div class="card border-warning">
                                <div class="card-header bg-warning text-dark">
                                    <h6 class="mb-0">
                                        <i class="fas fa-layer-group"></i> {% custom_trans_simple "Soil Preparation" %}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">{{ recommendations.soil_preparation }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <h6 class="mb-0">
                                        <i class="fas fa-seedling"></i> {% custom_trans_simple "Fertilizer Tips" %}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">{{ recommendations.fertilizer_tips }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Risk Factors -->
                    {% if recommendations.risk_factors %}
                        <div class="alert alert-warning mt-3">
                            <h6 class="text-warning">
                                <i class="fas fa-exclamation-triangle"></i> {% custom_trans_simple "Risk Factors to Consider:" %}
                            </h6>
                            <ul class="mb-0">
                                {% for risk in recommendations.risk_factors %}
                                    <li>{{ risk }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                    
                    <!-- Optimal Conditions -->
                    {% if recommendations.optimal_conditions %}
                        <div class="alert alert-success mt-3">
                            <h6 class="text-success">
                                <i class="fas fa-thumbs-up"></i> {% custom_trans_simple "Optimal Conditions:" %}
                            </h6>
                            <ul class="mb-0">
                                {% for key, value in recommendations.optimal_conditions.items %}
                                    <li><strong>{{ key|title }}:</strong> {{ value }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

            <!-- Tips for Accurate Measurements -->
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-lightbulb"></i> {% custom_trans_simple "Tips for Accurate Measurements" %}</h5>
                </div>
                <div class="card-body">
                    <ul class="list-unstyled">
                        <li><i class="fas fa-thermometer-half text-danger"></i> {% custom_trans_simple "Measure soil temperature at 10-15cm depth" %}</li>
                        <li><i class="fas fa-clock text-warning"></i> {% custom_trans_simple "Take readings in the morning for consistency" %}</li>
                        <li><i class="fas fa-map-marker-alt text-info"></i> {% custom_trans_simple "Record location coordinates if possible" %}</li>
                        <li><i class="fas fa-chart-bar text-success"></i> {% custom_trans_simple "Take multiple readings and average them" %}</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar"></i> {% custom_trans_simple "Recent Data Entries" %}</h5>
                </div>
                <div class="card-body">
                    {% if success %}
                        <div class="alert alert-success">
                            <h6><i class="fas fa-check-circle"></i> {{ message }}</h6>
                            <p class="mb-1">
                                <strong>üìç Location:</strong> {{ location }} | 
                                <strong>üåæ Field:</strong> {{ field_name }} | 
                                <strong>üå°Ô∏è Soil Temperature:</strong> {{ soil_temperature }}¬∞C |
                                <strong>üèóÔ∏è Soil Type:</strong> {{ soil_type|title }} |
                                <strong>üìÖ Season:</strong> {{ season|title }}
                            </p>
                        </div>
                    {% else %}
                        <div class="text-center text-muted">
                            <p><i class="fas fa-file-alt"></i> {% custom_trans_simple "No data recorded yet" %}</p>
                            <p>{% custom_trans_simple "Start by entering your first measurement above!" %}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="card mt-3">
                <div class="card-header">
                    <h5><i class="fas fa-bullseye"></i> {% custom_trans_simple "Why This Matters" %}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-6">
                            <h6 class="text-success"><i class="fas fa-seedling"></i> {% custom_trans_simple "Crop Growth" %}</h6>
                            <small>{% custom_trans_simple "Optimal temperature ranges for different crops" %}</small>
                        </div>
                        <div class="col-6">
                            <h6 class="text-info"><i class="fas fa-tint"></i> {% custom_trans_simple "Irrigation" %}</h6>
                            <small>{% custom_trans_simple "Water needs vary with soil temperature" %}</small>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-6">
                            <h6 class="text-warning"><i class="fas fa-seedling"></i> {% custom_trans_simple "Fertilizer" %}</h6>
                            <small>{% custom_trans_simple "Nutrient uptake depends on soil conditions" %}</small>
                        </div>
                        <div class="col-6">
                            <h6 class="text-primary"><i class="fas fa-chart-line"></i> {% custom_trans_simple "Yield" %}</h6>
                            <small>{% custom_trans_simple "Better data leads to better decisions" %}</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
